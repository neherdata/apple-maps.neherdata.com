<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">

<style>
#map-container {
    width: 100%;
    height: 100%;
}
</style>

<!-- TODO: Add the value of data-initial-token with a JWT
dynamically generated on the server -->
<script
  src="https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.core.js"
  crossorigin async
  data-callback="initMapKit"
  data-libraries="map,services,full-map,geojson"
  data-initial-token=${{ MAPS_JWT }}
></script>
<script type="module">
/**
 * Wait for MapKit JS to be loaded by the script tag,
 * calls `mapkit.init` to set authorizationCallback with your JWT.
 */
const setupMapKitJs = async() => {
    if (!window.mapkit || window.mapkit.loadedLibraries.length === 0) {
        // mapkit.core.js or the libraries are not loaded yet.
        // Set up the callback and wait for it to be called.
        await new Promise(resolve => { window.initMapKit = resolve });

        // Clean up
        delete window.initMapKit;
    }

    // TODO: For production use, the JWT should not be hard-coded into JS.
    const jwt = ${{ MAPS_JWT }};
    mapkit.init({
        authorizationCallback: done => { done(jwt); }
    });
};

/**
 * Script Entry Point
 */
const main = async() => {
    await setupMapKitJs();

    const secretariat = new mapkit.CoordinateRegion(
        new mapkit.Coordinate(40.3083382, -74.0697479),
        new mapkit.CoordinateSpan(0.167647972, 0.354985255)
    );

    // Create a map in the element whose ID is "map-container"
    const map = new mapkit.Map("map-container");
    map.region = secretariat;
};

main();

</script>
</head>

<body>
    <div id="map-container"></div>
</body>
</html>